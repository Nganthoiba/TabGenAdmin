
<?php   include("server_IP.php");
	if(!empty($_GET['method']))
	{			
		session_start();
		if(!isset($_SESSION['user_details'])){
                echo "<p align='center'>You have to <a href='index.html'>login</a> first<br/>";
        }
        else {
                $user_data = json_decode($_SESSION['user_details']);
                $user_name = $user_data->username;
				include ('ConnectAPI.php');
				$method = $_GET['method'];
				$type = empty($_GET['viewType'])?"all":$_GET['viewType'];
				echo getOrganisationList($user_name,$method,$type);
		}
	}
	else echo "no parameter passed";

	function getOrganisationList($username,$method,$type){
		$data="";
		$array = array("createdBy"=>$username);
		$url_send ="http://188.166.210.24:8065/api/v1/organisation/track";
		$str_data = json_encode($array);
		$connect = new ConnectAPI();
		$result = $connect->sendPostData($url_send,$str_data);
				
		if($result!=null){
			try{
				$responseData = json_decode($result);
				//$limit = $type=="all"?sizeof($responseData):5;
				if($type=="all"){
					$limit = sizeof($responseData);
				}else {
					if(sizeof($responseData)>5)
						$limit = 5;
					else
						$limit = sizeof($responseData);
				}
				if($connect->httpResponseCode==200){					
					if($method == "list"){
						for($j=0;$j<$limit;$j++){
							$data = $data."<li><label class='orgname'>".$responseData[$j]->name."</label></li>";
						}
					} 
					else {
						for($j=0;$j<$limit;$j++){
							$data = $data."<option>".$responseData[$j]->name."</option>";
						}
					}
				}else if($connect->httpResponseCode==0){
					$data = "Unable to connect API";
				}
				else 
					$data = $responseData->message;
			}catch(Exception $e){
				$data = "Exception: ".$e->getMessage();
			}
		}
		else $data = "Unable to connect API";
		return $data;
	}
?>
